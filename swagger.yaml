openapi: 3.0.3
info:
  title: Fraud Detection Lite API
  version: 1.0.0
  description: Fraud Detection and Risk Evaluation Service

servers:
  - url: http://localhost:8080

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    TransactionBase:
      type: object
      properties:
        id: { type: integer }
        decision: { type: string, enum: [ALLOW, FLAG, BLOCK, MFA_REQUIRED] }
        risk_score: { type: integer }
        triggered_factors:
          type: array
          items:
            type: string
            enum: [AMOUNT_DEVIATION, FREQUENCY_SPIKE, NEW_MODE, TIME_ANOMALY]
        created_at: { type: string, format: date-time }

    TransactionDetail:
      allOf:
        - $ref: '#/components/schemas/TransactionBase'
        - type: object
          properties:
            user_id: { type: integer }
            amount: { type: number }
            mode: { type: string, enum: [UPI, CARD, NETBANKING] }
            amount_deviation_score: { type: integer }
            frequency_deviation_score: { type: integer }
            mode_deviation_score: { type: integer }
            time_deviation_score: { type: integer }
            updated_at: { type: string, format: date-time }

    SuccessResponse:
      type: object
      properties:
        data: { type: object }

security:
  - BearerAuth: []

paths:
  /signup:
    post:
      summary: User signup
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email, password]
              properties:
                name: { type: string }
                email: { type: string }
                password: { type: string }
      responses:
        "201":
          description: Signup successful
          content:
            application/json:
              example:
                data:
                  message: "Signup Success!"
                  id: 1
                  name: "testName"
                  email: "test@example.com"

  /login:
    post:
      summary: User login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string }
                password: { type: string }
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              example:
                data:
                  message: "Logged in Successfully"
                  token: "eyJhbGciOiJIUzI1Ni..."

  /api/transactions:
    post:
      summary: Create transaction
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [amount, mode]
              properties:
                amount: { type: number }
                mode:
                  type: string
                  enum: [UPI, CARD, NETBANKING]
      responses:
        "200":
          description: Transaction evaluated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/TransactionBase'
              example:
                data:
                  id: 2
                  decision: "ALLOW"
                  risk_score: 55
                  triggered_factors: ["AMOUNT_DEVIATION", "NEW_MODE"]
                  created_at: "2026-02-05T14:21:25.559269Z"

    get:
      summary: Get paginated transactions
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: limit
          schema: { type: integer }
        - in: query
          name: offset
          schema: { type: integer }
      responses:
        "200":
          description: Transaction list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TransactionBase'
              example:
                data:
                  - id: 2
                    decision: "ALLOW"
                    risk_score: 55
                    triggered_factors: ["AMOUNT_DEVIATION", "NEW_MODE"]
                    created_at: "2026-02-05T14:21:25.559269Z"

  /api/transactions/{id}:
    get:
      summary: Get transaction by ID
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        "200":
          description: Transaction details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/TransactionDetail'
              example:
                data:
                  id: 2
                  user_id: 1
                  amount: 100
                  mode: "NETBANKING"
                  risk_score: 55
                  triggered_factors: ["AMOUNT_DEVIATION", "NEW_MODE"]
                  decision: "ALLOW"
                  amount_deviation_score: 100
                  frequency_deviation_score: 10
                  mode_deviation_score: 60
                  time_deviation_score: 5
                  created_at: "2026-02-05T14:21:25.559269"
                  updated_at: "2026-02-05T08:51:25.559133"

  /api/transactions/upload:
    post:
      summary: Upload bulk transactions (Synchronous)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: CSV/Excel file with amount,mode,createdAt
      responses:
        "200":
          description: Bulk processing completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      job_id: { type: string }
                      status: { type: string }
                      processed: { type: integer }
                      success: { type: integer }
                      failed: { type: integer }

  /api/logout:
    post:
      summary: Logout user
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Logout successful
          content:
            application/json:
              example:
                data:
                  message: "Logged out successfully"
